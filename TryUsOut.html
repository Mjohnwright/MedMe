<!DOCTYPE html>
<html lang="en">

<head>
  <title>Try Us Out</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- NIH -->
  <link href='https://clin-table-search.lhc.nlm.nih.gov/autocomplete-lhc-versions/10.1.0/autocomplete-lhc_jQueryUI.min.css'
    rel="stylesheet">
  <!-- jQuery -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--jQuery UI -->
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js" integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU="
    crossorigin="anonymous"></script>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/4.12.0/firebase.js"></script>
  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
    crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp"
    crossorigin="anonymous">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
    crossorigin="anonymous"></script>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" type="text/css">
  <!-- MedMe Styles -->
  <link rel="stylesheet" type="text/css" href="assets/CSS/reset.css">
  <link rel="stylesheet" type="text/css" href="assets/CSS/style.css">
  <!-- MeMe Scripts -->
  <script src="assets/javascript/medme-firebase.js"></script>


  <style>
      .modal-body .col-sm-2,
      .modal-body .col-sm-10 {
          width: 100%
      }

      .modal-body .control-label {
          text-align: left;
      }

      .modal-body .col-sm-offset-2 {
          margin-left: 15px;
      }

      #searchResults {
        z-index: 10000;
      }

  </style>
</head>

<body id="myPage" data-spy="scroll" data-target=".navbar" data-offset="60">
  <nav class="navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
      </div>
      <div class="collapse navbar-collapse" id="myNavbar">
        <ul class="nav navbar-nav navbar-right">
          <li>
            <a href="index.html">ABOUT</a>
          </li>
          <li>
            <a href="tryusout.html">TRY US OUT</a>
          </li>
          <li>
            <a href="signin.html">SIGN IN</a>
          </li>
          <li>
            <a href="myprofile.html">MY PROFILE</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <div class="jumbotron text-center">
    <img src="assets/images/logo2.png" alt="LOGO">
    </a>
  </div>
  <div id="about" class="container-fluid">
    <div class="row">
      <div class="col-sm-12 col-sm-offset-5">
        <h3>Let's get started!</h3>
      </div>
    </div>
  </div>
  <div class="alert-area"></div>
  <div class="row">
      <!-- Button trigger modal -->
      <button class="btn btn-primary btn-lg" data-toggle="modal" data-target="#add-drug-modal">
          Add Prescription
      </button>
  
      <!-- Modal -->
      <div class="modal fade" id="add-drug-modal" tabindex="-1" role="dialog">
          <div class="modal-dialog">
              <div class="modal-content">
                  <!-- Modal Header -->
                  <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal">
                          <span aria-hidden="true">&times;</span>
                          <span class="sr-only">Close</span>
                      </button>
                      <h4 class="modal-title">
                          Add Prescription
                      </h4>
                  </div>
  
                  <!-- Modal Body -->
                  <div class="modal-body">
  
                      <div class="form-group">
                          <label for="rxterms">Prescription or "DRUG" name</label>
                          <input type="text" id="rxterms" placeholder="ie. Tylenol...">
                      </div>
                      <div class="form-group">
                          <label for="drug-strengths">Dosage Prescribed</label>
                          <input type="text" id="drug-strengths" placeholder="ie. 5 mg...">
                      </div>
                      <div class="form-group">
                          <label for="rxcui">Dosage Prescribed</label>
                          <input type="text" id="rxcui" placeholder="RxCUI">
                      </div>
                      <div class="form-group">
                          <label for="how-often">How often Do you Take your Meds?</label>
                          <select class="form-control" id="drug-frequency">
                              <option>1</option>
                              <option>2</option>
                              <option>3</option>
                              <option>4</option>
                              <option>As Needed</option>
                          </select>
                      </div>
                  </div>
  
                  <!-- Modal Footer -->
                  <div class="modal-footer">
                      <button type="button" class="btn btn-default" data-dismiss="modal">
                          Close
                      </button>
                      <button type="button" class="btn btn-primary" id="btn-add-drug" type="submit">
                          Add Prescription
                      </button>
                  </div>
              </div>
          </div>
      </div>
  </div>

  <script src='https://clin-table-search.lhc.nlm.nih.gov/autocomplete-lhc-versions/15.1.1/autocomplete-lhc_jQuery.min.js'></script>

  <script>
    // Autocomplete Prescription or DRUG
    new Def.Autocompleter.Search('rxterms',
      'https://clin-table-search.lhc.nlm.nih.gov/api/rxterms/v3/search?ef=STRENGTHS_AND_FORMS,RXCUIS');

    // Creates empty dosage list until Prescription or DRUG is selected
    new Def.Autocompleter.Prefetch('drug-strengths', []);
    var NIHDrugName = '';
    var NIHRxCUI = '';
    var NIHDrugDosage = '';
    // Creates dosage list after Prescription or DRUG is select
    Def.Autocompleter.Event.observeListSelections('rxterms', function () {
      console.log($('#rxterms'));
      var drugField = $('#rxterms')[0];
      var drugName = drugField.value;
      NIHDrugName = drugField.value;
      console.log(drugName);
      var drugAutocomp = drugField.autocomp;
      console.log(drugAutocomp);
      var strengths = drugAutocomp.getItemExtraData(drugName)['STRENGTHS_AND_FORMS'];
      var rxcui = drugAutocomp.getItemExtraData(drugName)['RXCUIS'];

      console.log(strengths);
      if (strengths) {
        $('#drug-strengths')[0].autocomp.setListAndField(strengths, rxcui);
      }
    });
    Def.Autocompleter.Event.observeListSelections('drug-strengths', function (data) {
      console.log(data);
      NIHDrugDosage = data.final_val;
      NIHRxCUI = data.item_code
    })

    // watch for add drug request
    $("#btn-add-drug").click(function () {
      event.preventDefault();
      // get drug details from user input
      var drugName = NIHDrugName;
      var drugDosage = NIHDrugDosage;
      var drugFrequency = $("#drug-frequency").val();
      var drugRxCUI = NIHRxCUI;
      // add the drug to the user's profile
      console.log(drugName, drugDosage, drugFrequency, drugRxCUI);
      //addDrug(drugName, drugDosage, drugFrequency, drugRxCUI);
      $("#rxterms").val('');
      $("#drug-strengths").val('');
      $("#drug-frequency").val('');
    });
  </script>
</body>

</html>